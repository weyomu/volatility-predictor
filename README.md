# 比特币波动预警系统

<div align="center">

**一个基于LSTM深度学习的比特币波动风险预警系统**

专注于预测未来1-3天是否会出现大涨大跌，不涉及交易，只做风险预警

</div>

---

## 📋 目录

- [项目简介](#项目简介)
- [核心功能](#核心功能)
- [技术架构](#技术架构)
- [安装说明](#安装说明)
- [使用方法](#使用方法)
- [参数配置](#参数配置)
- [输出说明](#输出说明)
- [工作原理](#工作原理)
- [性能指标](#性能指标)
- [注意事项](#注意事项)
- [常见问题](#常见问题)

---

## 🎯 项目简介

本系统是一个基于深度学习（LSTM网络）的比特币波动预警工具，通过分析历史价格数据和技术指标，预测未来1-3天内比特币是否会出现**大幅波动**（涨跌幅超过设定阈值）。

**核心价值：**
- ⚠️ **风险预警**：提前识别潜在的大涨大跌风险
- 🎯 **二分类预测**：简单明确的"高波动"/"低波动"判断
- 📊 **可视化分析**：直观展示预警结果和模型性能
- 🚫 **不涉及交易**：仅做风险提示，不提供交易建议

**适用场景：**
- 投资风险管理
- 市场波动监控
- 投资决策辅助参考

---

## ⚡ 核心功能

### 1. 智能特征工程
自动提取85+个技术特征，包括：
- **价格特征**：开盘价、收盘价、最高价、最低价
- **技术指标**：SMA、EMA、MACD、RSI、布林带、ATR
- **时间序列**：过去60天的滞后价格
- **波动特征**：日变化、开盘收盘差、高低差、波动率

### 2. LSTM深度学习模型
- 多层LSTM网络捕捉时间序列模式
- Dropout防止过拟合
- 二分类输出（高波动/低波动）
- Early Stopping自动停止训练

### 3. 避免数据泄漏
- ✅ 按时间顺序划分训练集和测试集
- ✅ 仅使用训练集数据拟合标准化器
- ✅ 未来标签基于真实时间序列构建

### 4. 全面的性能评估
- 准确率（Accuracy）
- 精确率（Precision）
- 召回率（Recall）
- F1分数
- 混淆矩阵

### 5. 可视化输出
- 价格走势与波动预警标记
- 高波动概率曲线
- 混淆矩阵热力图
- 预警记录CSV导出

---

## 🛠 技术架构

### 核心技术栈

```
Python 3.x
│
├── 数据处理
│   ├── pandas          # 数据清洗和特征工程
│   ├── numpy           # 数值计算
│   └── sklearn         # 数据标准化
│
├── 深度学习
│   ├── TensorFlow      # 深度学习框架
│   └── Keras           # LSTM模型构建
│
└── 可视化
    ├── matplotlib      # 绘图
    └── seaborn         # 统计图表
```

### 模型架构

```
输入层 (60天 × 85特征)
    ↓
LSTM层 (64单元，返回序列)
    ↓
Dropout (30%)
    ↓
LSTM层 (32单元)
    ↓
Dropout (30%)
    ↓
全连接层 (16单元，ReLU)
    ↓
输出层 (1单元，Sigmoid)
    ↓
二分类输出 (0=低波动, 1=高波动)
```

---

## 📦 安装说明

### 环境要求
- Python 3.7+
- 操作系统：Windows/Linux/macOS

### 快速安装

1. **克隆或下载项目**
```bash
cd volatility-predictor
```

2. **安装依赖**
```bash
pip install pandas numpy matplotlib seaborn scikit-learn tensorflow
```

或使用requirements.txt（如果提供）：
```bash
pip install -r requirements.txt
```

3. **准备数据文件**
确保有比特币历史数据CSV文件（`比特币历史数据2.csv`），格式如下：

| 日期 | 收盘 | 开盘 | 高 | 低 | 交易量 | 涨跌幅 |
|------|------|------|----|----|--------|--------|
| 2020-01-01 | 7195.24 | 7200.17 | 7254.33 | 7174.94 | 28.7B | 0.13% |

---

## 🚀 使用方法

### 基本使用

```bash
python volatility_predictor.py
```

### 程序运行流程

```
[1/5] 加载数据和特征工程
      ↓
[2/5] 创建波动标签（阈值：3%）
      ↓
[3/5] 准备训练和测试数据（避免数据泄漏）
      ↓
[4/5] 训练波动预测模型
      ↓
[5/5] 在测试集上评估
      ↓
输出预警结果和可视化
```

### 预期输出

运行后会生成：
1. **终端输出**：模型性能指标、预警事件、未来预测
2. **波动预警结果.png**：可视化图表
3. **波动预警记录.csv**：预警历史记录

---

## ⚙️ 参数配置

### 主要参数（在`main()`函数中）

| 参数 | 默认值 | 说明 | 建议范围 |
|------|--------|------|----------|
| `DAYS_AHEAD` | 1 | 预测未来几天 | 1-3天 |
| `THRESHOLD` | 0.03 | 波动阈值（3%） | 0.02-0.05 |
| `TIME_STEPS` | 60 | 使用过去多少天数据 | 30-90天 |
| `TRAIN_RATIO` | 0.8 | 训练集比例 | 0.7-0.9 |

### 调整参数示例

```python
# 在volatility_predictor.py的main()函数中修改

# 预测未来3天，阈值5%
DAYS_AHEAD = 3
THRESHOLD = 0.05

# 使用过去90天数据
TIME_STEPS = 90

# 70%训练，30%测试
TRAIN_RATIO = 0.7
```

---

## 📊 输出说明

### 1. 控制台输出

#### 性能指标示例
```
==================================================================
模型性能评估
==================================================================
准确率 (Accuracy):  75.32%  - 预测对的比例
精确率 (Precision): 68.50%  - 预警准确度（预警时真的高波动的概率）
召回率 (Recall):    72.15%  - 捕获率（高波动时能预警的概率）
F1分数:            0.703     - 综合指标（精确率和召回率的平均）

混淆矩阵:
              预测低波动  预测高波动
实际低波动:      520        95
实际高波动:       65       178
```

#### 预警示例
```
==================================================================
最近的高波动预警事件
==================================================================
2024-10-15 | 价格: $62,453.20 | 预警概率: 78.3% | ✅ 正确预警
2024-10-22 | 价格: $65,890.45 | 预警概率: 65.2% | ❌ 误报
```

#### 未来预测示例
```
==================================================================
未来1天波动预警
==================================================================
当前日期: 2024-11-14
当前价格: $68,245.67

未来1天波动预测:
高波动概率: 82.4%
⚠️  预警：未来1天可能出现大涨大跌（涨跌幅>±3%）
建议：注意风险，考虑止损或观望
```

### 2. 可视化图表

**波动预警结果.png** 包含三个子图：

1. **价格与波动预警**
   - 蓝色曲线：比特币价格走势
   - 红色×：实际高波动点
   - 橙色○：预测高波动点

2. **预测概率曲线**
   - 紫色曲线：每天的高波动概率
   - 红色虚线：50%预警阈值
   - 红色填充：高波动区域

3. **混淆矩阵**
   - 热力图展示分类结果

### 3. CSV导出文件

**波动预警记录.csv** 包含：
- 日期
- 价格
- 预警概率
- 实际波动（高/低）
- 预警结果（正确/误报）

---

## 🔍 工作原理

### 系统流程图

```
历史数据
    ↓
特征工程（技术指标计算）
    ↓
创建波动标签
│ - 如果未来N天涨跌幅 > 阈值 → 高波动(1)
│ - 否则 → 低波动(0)
    ↓
数据划分（时间序列）
│ - 训练集：80% (早期数据)
│ - 测试集：20% (最近数据)
    ↓
数据标准化（仅训练集拟合）
    ↓
LSTM模型训练
│ - 输入：过去60天的85个特征
│ - 输出：高波动概率(0-1)
    ↓
测试集评估
    ↓
未来预测
```

### 核心算法

#### 1. 波动标签定义（关键创新）

```python
# 计算未来N天的最大涨跌幅
未来涨跌幅 = |未来价格 - 当前价格| / 当前价格
最大涨跌幅 = max(未来1天涨跌幅, 未来2天涨跌幅, ...)

# 标签判定
if 最大涨跌幅 > 阈值:
    标签 = 1  # 高波动
else:
    标签 = 0  # 低波动
```

#### 2. 避免数据泄漏（关键改进）

```python
# ✅ 正确做法
1. 按时间划分训练/测试集
2. 仅用训练集拟合标准化器
3. 分别转换训练集和测试集

# ❌ 错误做法（数据泄漏）
1. 先标准化全部数据
2. 再划分训练/测试集
→ 导致模型"看到"未来数据，性能虚高
```

---

## 📈 性能指标

### 指标解读

| 指标 | 含义 | 理想值 | 实际意义 |
|------|------|--------|----------|
| **准确率** | 总体预测正确率 | >70% | 反映整体表现 |
| **精确率** | 预警时真的高波动比例 | >65% | 避免频繁误报 |
| **召回率** | 高波动时能预警比例 | >70% | 不漏掉风险事件 |
| **F1分数** | 精确率和召回率平均 | >0.65 | 综合平衡指标 |

### 混淆矩阵解读

```
              预测低波动  预测高波动
实际低波动:    TN (好)    FP (误报)
实际高波动:    FN (漏报)   TP (好)
```

- **TN（真负例）**：正确预测低波动 → 最多的情况
- **TP（真正例）**：正确预警高波动 → 核心价值
- **FP（假正例）**：误报，实际没有高波动 → 影响信任度
- **FN（假负例）**：漏报，未预警但实际高波动 → 最危险

---

## ⚠️ 注意事项

### 1. 数据要求
- ✅ 需要完整的历史数据（建议>2000天）
- ✅ 数据格式必须包含：日期、收盘、开盘、高、低、交易量、涨跌幅
- ✅ 数据应按时间顺序排列
- ⚠️ 数据质量直接影响预测效果

### 2. 使用限制
- 🚫 **不保证预测准确性**：金融市场存在不可预测性
- 🚫 **不作为交易依据**：仅供风险参考，不构成投资建议
- 🚫 **不适用于高频交易**：预测周期为1-3天，非短期
- ⚠️ **历史表现不代表未来**：市场环境变化可能影响模型效果

### 3. 技术注意
- 💻 **计算资源**：训练LSTM需要一定CPU/GPU资源
- ⏱️ **训练时间**：取决于数据量和硬件，通常5-20分钟
- 🔧 **参数调优**：不同阈值和参数会影响预警频率和准确性
- 📊 **中文字体**：可视化使用SimHei字体，需系统支持

### 4. 风险提示
```
⚠️ 重要声明 ⚠️

本系统仅为技术研究和学习用途，预测结果不构成任何投资建议。
加密货币市场波动性极大，投资需谨慎，请理性决策。
使用本系统造成的任何损失，开发者不承担任何责任。

投资有风险，入市需谨慎！
```

---

## ❓ 常见问题

### Q1: 为什么准确率不是100%？
**A:** 金融市场受多种因素影响（新闻、政策、全球事件等），历史数据无法完全预测未来。70%+的准确率已经是较好的表现。

### Q2: 如何提高预测效果？
**A:** 
- 增加更多特征（如新闻情绪、链上数据）
- 调整模型结构（增加层数、单元数）
- 优化超参数（学习率、dropout比例）
- 使用更长时间的历史数据

### Q3: 预警频率太高/太低怎么办？
**A:** 调整`THRESHOLD`参数：
- 预警太多（误报多）→ 提高阈值（如0.05）
- 预警太少（漏报多）→ 降低阈值（如0.02）

### Q4: 为什么有时预警后没有大波动？
**A:** 这是**假正例（FP）**，即误报。原因可能是：
- 市场突发事件改变趋势
- 模型对某些模式过度敏感
- 训练数据中的噪音

### Q5: 能否预测具体涨跌方向？
**A:** 当前版本仅预测**波动幅度**，不预测方向。如需方向预测，需改为三分类（上涨/下跌/平稳）。

### Q6: 数据文件格式要求？
**A:** CSV文件需包含以下列（中文列名）：
- 日期（格式：YYYY-MM-DD）
- 收盘、开盘、高、低（数值或带货币符号）
- 交易量（可带B/M/K后缀）
- 涨跌幅（百分比格式，如"2.5%"）

### Q7: 如何用于其他加密货币？
**A:** 只需更换数据源：
1. 准备其他币种的历史数据CSV
2. 确保列名和格式一致
3. 修改代码中的数据文件路径

### Q8: 模型需要定期重新训练吗？
**A:** 建议：
- 每月更新一次数据并重新训练
- 市场环境大变化后重新训练
- 预测效果明显下降时重新训练

---

## 📚 扩展阅读

### 技术指标说明
- **SMA/EMA**：简单/指数移动平均，反映趋势
- **MACD**：趋势强度和转折点
- **RSI**：相对强弱指标，衡量超买超卖
- **布林带**：价格波动区间
- **ATR**：平均真实波幅，衡量波动性

### LSTM原理
LSTM（长短期记忆网络）是一种特殊的RNN，能够学习长期依赖关系，特别适合时间序列预测。

### 推荐资源
- TensorFlow官方文档：https://www.tensorflow.org/
- Pandas数据处理：https://pandas.pydata.org/
- 时间序列分析教程

---

## 📄 许可证

本项目仅供学习和研究使用，请勿用于商业目的。

---

## 🤝 贡献

欢迎提出改进建议！可以通过以下方式：
- 提交Issue报告问题
- 提交Pull Request改进代码
- 分享使用经验和优化方案

---

## 📧 联系方式

如有问题或建议，欢迎联系。

---

<div align="center">

**⭐ 如果这个项目对你有帮助，请给个Star！ ⭐**

*Made with ❤️ for Bitcoin enthusiasts*

</div>

